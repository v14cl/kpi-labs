@startuml
actor Client
participant "Frontend UI" as UI
participant "BookController" as Controller
participant "BookService" as Service
participant "BookRepository" as Repository
database "Database" as DB

loop searching for book
    Client -> UI: Enter search query
    activate UI
    UI -> Controller: GET /books?search=query
    activate Controller
    Controller -> Service: searchBooks(query)
    activate Service
    Service -> Repository: search(query)
    activate Repository
    Repository -> DB: SELECT ... WHERE title LIKE ...
    activate DB
    DB --> Repository: return List<Book>
    deactivate DB
    Repository --> Service: return List<Book>
    deactivate Repository
    Service --> Controller: return List<Book>
    deactivate Service
    Controller --> UI: return List<Book>
    deactivate Controller
    UI --> Client: Show book/book details
    deactivate UI
end

alt Book is available
    Client -> UI: Add book to cart
    activate UI
    UI -> Controller: POST /cart
    activate Controller
    Controller -> Service: addToCart(book, client)
    activate Service
    Service -> Repository: saveToCart()
    activate Repository
    Repository -> DB: INSERT INTO cart ...
    activate DB
    DB --> Repository: return success
    deactivate DB
    Repository --> Service: return success
    deactivate Repository
    Service --> Controller: return success
    deactivate Service
    Controller --> UI: return success
    deactivate Controller

    UI --> Client: ShowCart()
    deactivate UI

else Book unavailable
    Client -> UI: Add book to cart
    activate UI
    UI --> Client: Show "Book is unavailable"
    UI -> Controller: POST /waiting-list
    activate Controller
    Controller -> Service: addToWaitingList(client, book)
    activate Service
    Service -> Repository: saveWaitingRequest()
    activate Repository
    Repository -> DB: INSERT INTO waiting_list ...
    activate DB
    DB --> Repository: return success
    deactivate DB
    Repository --> Service: return success
    deactivate Repository
    Service --> Controller: return success
    deactivate Service
    Controller --> UI: return success
    deactivate Controller

    UI --> Client: Show "Book added to waiting list"
    deactivate UI
end
@enduml
